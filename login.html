<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>S_P Bricks | Login</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: Georgia, serif;
  background:#1f1f1f;
  color:#eee;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}
.box{
  background:#2a2a2a;
  padding:30px;
  width:340px;
  border-left:6px solid #8b3a2b;
}
h2{ margin-top:0; }
input, select, button{
  width:100%;
  padding:10px;
  margin-top:10px;
  font-size:1rem;
}
button{
  background:#8b3a2b;
  color:#fff;
  border:none;
  cursor:pointer;
}
button:hover{
  background:#6f2e22;
}
.note{
  font-size:0.85rem;
  color:#aaa;
  margin-top:10px;
}
</style>
</head>

<body>

<div class="box">
  <h2>Login</h2>

  <input id="name" placeholder="Full Name" required>
  <input id="phone" placeholder="+91XXXXXXXXXX" required>

  <select id="role">
    <option value="Individual">Individual</option>
    <option value="Contractor">Contractor</option>
    <option value="Dealer">Dealer</option>
  </select>

  <!-- Firebase requires this div -->
  <div id="recaptcha-container"></div>

  <button onclick="sendOTP()">Send OTP</button>

  <input id="otp" placeholder="Enter OTP">
  <button onclick="verifyOTP()">Verify & Login</button>

  <p class="note">OTP will be sent via SMS to your phone.</p>
</div>

<!-- ðŸ”¥ FIREBASE SDKs (MUST COME FIRST) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- ðŸ”¥ YOUR FIREBASE CONFIG -->
<script src="firebase.js"></script>

<script>
/* Initialize invisible reCAPTCHA */
window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(
  'recaptcha-container',
  { size: 'invisible' }
);

let confirmationResult;

/* Send OTP */
function sendOTP(){
  const phoneNumber = document.getElementById("phone").value.trim();

  if(!phoneNumber.startsWith("+")){
    alert("Phone number must start with +91");
    return;
  }

  auth.signInWithPhoneNumber(phoneNumber, window.recaptchaVerifier)
    .then(result => {
      confirmationResult = result;
      alert("OTP sent via SMS");
    })
    .catch(error => {
      console.error(error);
      alert(error.message);
    });
}

/* Verify OTP */
function verifyOTP(){
  const otp = document.getElementById("otp").value.trim();
  if(!confirmationResult){
    alert("Please request OTP first");
    return;
  }

  confirmationResult.confirm(otp)
    .then(res => {
      const uid = res.user.uid;

      db.collection("users").doc(uid).set({
        name: document.getElementById("name").value,
        phone: document.getElementById("phone").value,
        role: document.getElementById("role").value,
        dealerApproved: false,
        totalOrdered: 0,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge:true });

      localStorage.setItem("uid", uid);
      window.location.href = "index.html";
    })
    .catch(error => {
      console.error(error);
      alert("Invalid OTP");
    });
}
</script>

</body>
</html>

